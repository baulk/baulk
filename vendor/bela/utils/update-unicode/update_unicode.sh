#!/bin/sh
#See http://www.unicode.org/reports/tr44/
#
#Me Enclosing_Mark  an enclosing combining mark
#Mn Nonspacing_Mark a nonspacing combining mark (zero advance width)
#Cf Format          a format control character
#
cd "$(dirname "$0")" || exit

# RUNING under WSL

UNICODEWIDTH_HPP=$(git rev-parse --show-toplevel)/include/bela/__unicode/unicode-width.hpp

wget -N http://www.unicode.org/Public/UCD/latest/ucd/UnicodeData.txt \
        http://www.unicode.org/Public/UCD/latest/ucd/EastAsianWidth.txt &&
        if ! test -d uniset; then
                git clone git@github.com:depp/uniset.git &&
                        (cd uniset && git checkout 4b186196dd)
        fi &&
        (
                cd uniset &&
                        if ! test -x uniset; then
                                autoreconf -i &&
                                        ./configure --enable-warnings=-Werror CFLAGS='-O0 -ggdb'
                        fi &&
                        make
        ) &&
        UNICODE_DIR=. && export UNICODE_DIR &&
        cat >"$UNICODEWIDTH_HPP" <<-EOF
// ------------ codegen by update_unicode.sh ------------
// Code generated by update_unicode. DO NOT EDIT.


namespace bela::unicode {

struct interval {
  char32_t first;
  char32_t last;
};


[[maybe_unused]] constexpr const interval zero_width[] = {
    $(uniset/uniset --32 cat:Me,Mn,Cf + U+1160..U+11FF - U+00AD)
};

[[maybe_unused]] constexpr const interval double_width[] = {
    $(uniset/uniset --32 eaw:F,W)
};

}
EOF
